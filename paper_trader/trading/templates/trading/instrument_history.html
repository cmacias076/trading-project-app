{% extends 'trading/base.html' %}

{% block title %}Historical Charts{% endblock %}

{% block content %}
<div class="container mt-4">

  <h1 class="mb-4">ðŸ“ˆ Historical Charts for All Instruments</h1>

  <div id="charts-container" class="row g-4"></div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const data = JSON.parse(`{{ historical_data|safe|escapejs }}`);

  data.forEach(instrument => {
    // Create column
    const colDiv = document.createElement('div');
    colDiv.classList.add('col-12', 'col-md-6');

    // Create card container
    const cardDiv = document.createElement('div');
    cardDiv.classList.add('card', 'shadow-sm', 'p-3', 'mb-4');

    // Canvas inside card
    const canvas = document.createElement('canvas');
    cardDiv.appendChild(canvas);
    colDiv.appendChild(cardDiv);
    document.getElementById('charts-container').appendChild(colDiv);

    const ctx = canvas.getContext('2d');
    const gradient = ctx.createLinearGradient(0, 0, 0, 400);
    gradient.addColorStop(0, 'rgba(75, 192, 192, 0.4)');
    gradient.addColorStop(1, 'rgba(75, 192, 192, 0)');

    new Chart(ctx, {
      type: 'line',
      data: {
        labels: instrument.dates,
        datasets: [{
          label: instrument.symbol,
          data: instrument.prices,
          borderColor: 'rgba(75, 192, 192, 1)',
          backgroundColor: gradient,
          fill: true,
          tension: 0.3,
          pointRadius: 4,
          pointHoverRadius: 7
        }]
      },
      options: {
        responsive: true,
        plugins: {
          tooltip: {
            mode: 'index',
            intersect: false,
            callbacks: {
              label: context => `$${context.formattedValue}`
            }
          },
          title: {
            display: true,
            text: `Price History - ${instrument.symbol}`,
            font: { size: 16 }
          },
          legend: { display: false }
        },
        scales: {
          x: { title: { display: true, text: 'Date' } },
          y: { title: { display: true, text: 'Price (USD)' } }
        }
      }
    });
  });
</script>
{% endblock %}
