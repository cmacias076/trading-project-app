{% extends 'trading/base.html' %}

{% block title %}Historical Charts{% endblock %}

{% block content %}
<div class="container mt-4">

  <h1 class="mb-4">ðŸ“ˆ Historical Charts for All Instruments</h1>

  <div id="charts-container" class="row g-4"></div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const data = JSON.parse(`{{ historical_data|safe|escapejs }}`);

data.forEach(instrument => {
  // Container column
  const colDiv = document.createElement('div');
  colDiv.classList.add('col-12', 'col-md-6');

  // Card wrapper
  const cardDiv = document.createElement('div');
  cardDiv.classList.add('card', 'shadow-sm', 'p-3', 'mb-4');

  // Canvas for chart
  const canvas = document.createElement('canvas');
  cardDiv.appendChild(canvas);
  colDiv.appendChild(cardDiv);
  document.getElementById('charts-container').appendChild(colDiv);

  // Gradient
  const ctx = canvas.getContext('2d');
  const gradient = ctx.createLinearGradient(0, 0, 0, 400);
  gradient.addColorStop(0, 'rgba(13, 110, 253, 0.4)');
  gradient.addColorStop(1, 'rgba(13, 110, 253, 0)');

  // Chart
  new Chart(canvas, {
    type: 'line',
    data: {
      labels: instrument.dates,
      datasets: [{
        label: instrument.symbol,
        data: instrument.prices,
        borderColor: 'rgba(13, 110, 253, 1)',
        backgroundColor: gradient,
        fill: true,
        tension: 0.3,
        pointRadius: 2,
        pointHoverRadius: 5
      }]
    },
    options: {
      responsive: true,
      plugins: {
        title: {
          display: true,
          text: `Price History - ${instrument.symbol}`,
          font: { size: 16 }
        },
        tooltip: {
          enabled: true,
          mode: 'index',
          intersect: false,
          callbacks: {
            label: function(ctx) { return `$${ctx.formattedValue}`; }
          }
        },
        legend: { display: false }
      },
      scales: {
        x: { title: { display: true, text: 'Date' }},
        y: { title: { display: true, text: 'Price (USD)' }}
      }
    }
  });
});
</script>
{% endblock %}
