{% extends 'trading/base.html' %}

{% block title %}Historical Charts{% endblock %}

{% block content %}
  <h2>Historical Charts for All Instruments</h2>
  <div id="charts-container"></div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const data = JSON.parse(`{{ historical_data|safe|escapejs }}`);

    data.forEach(instrument => {
      const canvas = document.createElement('canvas');
      canvas.classList.add('mb-5');
      document.getElementById('charts-container').appendChild(canvas);

      new Chart(canvas, {
        type: 'line',
        data: {
          labels: instrument.dates,
          datasets: [{
            label: instrument.symbol,
            data: instrument.prices,
            borderColor: 'rgba(75, 192, 192, 1)',
            tension: 0.3
          }]
        },
        options: {
          responsive: true,
          plugins: {
            title: {
              display: true,
              text: `Price History - ${instrument.symbol}`
            }
          }
        }
      });
    });
  </script>
{% endblock %}
